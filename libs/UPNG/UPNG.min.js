!function(){var e,r={};"object"==typeof module?module.exports=r:window.UPNG=r,e="function"==typeof require?require("pako"):window.pako,function(e,r){e.toRGBA8=function(r){var t=r.width,a=r.height;if(null==r.tabs.acTL)return[e.toRGBA8.decodeImage(r.data,t,a,r).buffer];var n=[];null==r.frames[0].data&&(r.frames[0].data=r.data);for(var i,f=new Uint8Array(t*a*4),o=0;o<r.frames.length;o++){var s=r.frames[o],l=s.rect.x,c=s.rect.y,v=s.rect.width,u=s.rect.height,d=e.toRGBA8.decodeImage(s.data,v,u,r);if(0==o?i=d:0==s.blend?e._copyTile(d,v,u,i,t,a,l,c,0):1==s.blend&&e._copyTile(d,v,u,i,t,a,l,c,1),n.push(i.buffer),i=i.slice(0),0==s.dispose);else if(1==s.dispose)e._copyTile(f,v,u,i,t,a,l,c,0);else if(2==s.dispose){for(var h=o-1;2==r.frames[h].dispose;)h--;i=new Uint8Array(n[h]).slice(0)}}return n},e.toRGBA8.decodeImage=function(r,t,a,n){var i=t*a,f=e.decode._getBPP(n),o=Math.ceil(t*f/8),s=new Uint8Array(4*i),l=new Uint32Array(s.buffer),c=n.ctype,v=n.depth,u=e._bin.readUshort;if(6==c){var d=i<<2;if(8==v)for(var h=0;d>h;h++)s[h]=r[h];if(16==v)for(var h=0;d>h;h++)s[h]=r[h<<1]}else if(2==c){var p=n.tabs.tRNS,b=-1,g=-1,m=-1;if(p&&(b=p[0],g=p[1],m=p[2]),8==v)for(var h=0;i>h;h++){var y=h<<2,w=3*h;s[y]=r[w],s[y+1]=r[w+1],s[y+2]=r[w+2],s[y+3]=255,-1!=b&&r[w]==b&&r[w+1]==g&&r[w+2]==m&&(s[y+3]=0)}if(16==v)for(var h=0;i>h;h++){var y=h<<2,w=6*h;s[y]=r[w],s[y+1]=r[w+2],s[y+2]=r[w+4],s[y+3]=255,-1!=b&&u(r,w)==b&&u(r,w+2)==g&&u(r,w+4)==m&&(s[y+3]=0)}}else if(3==c){var A=n.tabs.PLTE,U=n.tabs.tRNS,_=U?U.length:0;if(1==v)for(var q=0;a>q;q++)for(var I=q*o,M=q*t,h=0;t>h;h++){var y=M+h<<2,T=r[I+(h>>3)]>>7-((7&h)<<0)&1,z=3*T;s[y]=A[z],s[y+1]=A[z+1],s[y+2]=A[z+2],s[y+3]=_>T?U[T]:255}if(2==v)for(var q=0;a>q;q++)for(var I=q*o,M=q*t,h=0;t>h;h++){var y=M+h<<2,T=r[I+(h>>2)]>>6-((3&h)<<1)&3,z=3*T;s[y]=A[z],s[y+1]=A[z+1],s[y+2]=A[z+2],s[y+3]=_>T?U[T]:255}if(4==v)for(var q=0;a>q;q++)for(var I=q*o,M=q*t,h=0;t>h;h++){var y=M+h<<2,T=r[I+(h>>1)]>>4-((1&h)<<2)&15,z=3*T;s[y]=A[z],s[y+1]=A[z+1],s[y+2]=A[z+2],s[y+3]=_>T?U[T]:255}if(8==v)for(var h=0;i>h;h++){var y=h<<2,T=r[h],z=3*T;s[y]=A[z],s[y+1]=A[z+1],s[y+2]=A[z+2],s[y+3]=_>T?U[T]:255}}else if(4==c){if(8==v)for(var h=0;i>h;h++){var y=h<<2,R=h<<1,N=r[R];s[y]=N,s[y+1]=N,s[y+2]=N,s[y+3]=r[R+1]}if(16==v)for(var h=0;i>h;h++){var y=h<<2,R=h<<2,N=r[R];s[y]=N,s[y+1]=N,s[y+2]=N,s[y+3]=r[R+2]}}else if(0==c){var b=n.tabs.tRNS?n.tabs.tRNS:-1;if(1==v)for(var h=0;i>h;h++){var N=255*(r[h>>3]>>7-(7&h)&1),L=N==255*b?0:255;l[h]=L<<24|N<<16|N<<8|N}if(2==v)for(var h=0;i>h;h++){var N=85*(r[h>>2]>>6-((3&h)<<1)&3),L=N==85*b?0:255;l[h]=L<<24|N<<16|N<<8|N}if(4==v)for(var h=0;i>h;h++){var N=17*(r[h>>1]>>4-((1&h)<<2)&15),L=N==17*b?0:255;l[h]=L<<24|N<<16|N<<8|N}if(8==v)for(var h=0;i>h;h++){var N=r[h],L=N==b?0:255;l[h]=L<<24|N<<16|N<<8|N}if(16==v)for(var h=0;i>h;h++){var N=r[h<<1],L=u(r,h<<1)==b?0:255;l[h]=L<<24|N<<16|N<<8|N}}return s},e.decode=function(r){for(var t,a=new Uint8Array(r),n=8,i=e._bin,f=i.readUshort,o=i.readUint,s={tabs:{},frames:[]},l=new Uint8Array(a.length),c=0,v=0,u=[137,80,78,71,13,10,26,10],d=0;8>d;d++)if(a[d]!=u[d])throw"The input is not a PNG file!";for(;n<a.length;){var h=i.readUint(a,n);n+=4;var p=i.readASCII(a,n,4);if(n+=4,"IHDR"==p)e.decode._IHDR(a,n,s);else if("IDAT"==p){for(var d=0;h>d;d++)l[c+d]=a[n+d];c+=h}else if("acTL"==p)s.tabs[p]={num_frames:o(a,n),num_plays:o(a,n+4)},t=new Uint8Array(a.length);else if("fcTL"==p){if(0!=v){var b=s.frames[s.frames.length-1];b.data=e.decode._decompress(s,t.slice(0,v),b.rect.width,b.rect.height),v=0}var g={x:o(a,n+12),y:o(a,n+16),width:o(a,n+4),height:o(a,n+8)},m=f(a,n+22);m=f(a,n+20)/(0==m?100:m);var y={rect:g,delay:Math.round(1e3*m),dispose:a[n+24],blend:a[n+25]};s.frames.push(y)}else if("fdAT"==p){for(var d=0;h-4>d;d++)t[v+d]=a[n+d+4];v+=h-4}else if("pHYs"==p)s.tabs[p]=[i.readUint(a,n),i.readUint(a,n+4),a[n+8]];else if("cHRM"==p){s.tabs[p]=[];for(var d=0;8>d;d++)s.tabs[p].push(i.readUint(a,n+4*d))}else if("tEXt"==p){null==s.tabs[p]&&(s.tabs[p]={});var w=i.nextZero(a,n),A=i.readASCII(a,n,w-n),U=i.readASCII(a,w+1,n+h-w-1);s.tabs[p][A]=U}else if("iTXt"==p){null==s.tabs[p]&&(s.tabs[p]={});var w=0,_=n;w=i.nextZero(a,_);var A=i.readASCII(a,_,w-_);_=w+1;a[_],a[_+1];_+=2,w=i.nextZero(a,_);i.readASCII(a,_,w-_);_=w+1,w=i.nextZero(a,_);i.readUTF8(a,_,w-_);_=w+1;var U=i.readUTF8(a,_,h-(_-n));s.tabs[p][A]=U}else if("PLTE"==p)s.tabs[p]=i.readBytes(a,n,h);else if("hIST"==p){var q=s.tabs.PLTE.length/3;s.tabs[p]=[];for(var d=0;q>d;d++)s.tabs[p].push(f(a,n+2*d))}else if("tRNS"==p)3==s.ctype?s.tabs[p]=i.readBytes(a,n,h):0==s.ctype?s.tabs[p]=f(a,n):2==s.ctype&&(s.tabs[p]=[f(a,n),f(a,n+2),f(a,n+4)]);else if("gAMA"==p)s.tabs[p]=i.readUint(a,n)/1e5;else if("sRGB"==p)s.tabs[p]=a[n];else if("bKGD"==p)0==s.ctype||4==s.ctype?s.tabs[p]=[f(a,n)]:2==s.ctype||6==s.ctype?s.tabs[p]=[f(a,n),f(a,n+2),f(a,n+4)]:3==s.ctype&&(s.tabs[p]=a[n]);else if("IEND"==p)break;n+=h;i.readUint(a,n);n+=4}if(0!=v){var b=s.frames[s.frames.length-1];b.data=e.decode._decompress(s,t.slice(0,v),b.rect.width,b.rect.height),v=0}return s.data=e.decode._decompress(s,l,s.width,s.height),delete s.compress,delete s.interlace,delete s.filter,s},e.decode._decompress=function(r,t,a,n){return 0==r.compress&&(t=e.decode._inflate(t)),0==r.interlace?t=e.decode._filterZero(t,r,0,a,n):1==r.interlace&&(t=e.decode._readInterlace(t,r)),t},e.decode._inflate=function(e){return r.inflate(e)},e.decode._readInterlace=function(r,t){for(var a=t.width,n=t.height,i=e.decode._getBPP(t),f=i>>3,o=Math.ceil(a*i/8),s=new Uint8Array(n*o),l=0,c=[0,0,4,0,2,0,1],v=[0,4,0,2,0,1,0],u=[8,8,8,4,4,2,2],d=[8,8,4,4,2,2,1],h=0;7>h;){for(var p=u[h],b=d[h],g=0,m=0,y=c[h];n>y;)y+=p,m++;for(var w=v[h];a>w;)w+=b,g++;var A=Math.ceil(g*i/8);e.decode._filterZero(r,t,l,g,m);for(var U=0,_=c[h];n>_;){for(var q=v[h],I=l+U*A<<3;a>q;){if(1==i){var M=r[I>>3];M=M>>7-(7&I)&1,s[_*o+(q>>3)]|=M<<7-((3&q)<<0)}if(2==i){var M=r[I>>3];M=M>>6-(7&I)&3,s[_*o+(q>>2)]|=M<<6-((3&q)<<1)}if(4==i){var M=r[I>>3];M=M>>4-(7&I)&15,s[_*o+(q>>1)]|=M<<4-((1&q)<<2)}if(i>=8)for(var T=_*o+q*f,z=0;f>z;z++)s[T+z]=r[(I>>3)+z];I+=i,q+=b}U++,_+=p}g*m!=0&&(l+=m*(1+A)),h+=1}return s},e.decode._getBPP=function(e){var r=[1,null,3,1,2,null,4][e.ctype];return r*e.depth},e.decode._filterZero=function(r,t,a,n,i){var f=e.decode._getBPP(t),o=Math.ceil(n*f/8),s=e.decode._paeth;f=Math.ceil(f/8);for(var l=0;i>l;l++){var c=a+l*o,v=c+l+1,u=r[v-1];if(0==u)for(var d=0;o>d;d++)r[c+d]=r[v+d];else if(1==u){for(var d=0;f>d;d++)r[c+d]=r[v+d];for(var d=f;o>d;d++)r[c+d]=r[v+d]+r[c+d-f]&255}else if(0==l){for(var d=0;f>d;d++)r[c+d]=r[v+d];if(2==u)for(var d=f;o>d;d++)r[c+d]=255&r[v+d];if(3==u)for(var d=f;o>d;d++)r[c+d]=r[v+d]+(r[c+d-f]>>1)&255;if(4==u)for(var d=f;o>d;d++)r[c+d]=r[v+d]+s(r[c+d-f],0,0)&255}else{if(2==u)for(var d=0;o>d;d++)r[c+d]=r[v+d]+r[c+d-o]&255;if(3==u){for(var d=0;f>d;d++)r[c+d]=r[v+d]+(r[c+d-o]>>1)&255;for(var d=f;o>d;d++)r[c+d]=r[v+d]+(r[c+d-o]+r[c+d-f]>>1)&255}if(4==u){for(var d=0;f>d;d++)r[c+d]=r[v+d]+s(0,r[c+d-o],0)&255;for(var d=f;o>d;d++)r[c+d]=r[v+d]+s(r[c+d-f],r[c+d-o],r[c+d-f-o])&255}}}return r},e.decode._paeth=function(e,r,t){var a=e+r-t,n=Math.abs(a-e),i=Math.abs(a-r),f=Math.abs(a-t);return i>=n&&f>=n?e:f>=i?r:t},e.decode._IHDR=function(r,t,a){var n=e._bin;a.width=n.readUint(r,t),t+=4,a.height=n.readUint(r,t),t+=4,a.depth=r[t],t++,a.ctype=r[t],t++,a.compress=r[t],t++,a.filter=r[t],t++,a.interlace=r[t],t++},e._bin={nextZero:function(e,r){for(;0!=e[r];)r++;return r},readUshort:function(e,r){return e[r]<<8|e[r+1]},writeUshort:function(e,r,t){e[r]=t>>8&255,e[r+1]=255&t},readUint:function(e,r){return 16777216*e[r]+(e[r+1]<<16|e[r+2]<<8|e[r+3])},writeUint:function(e,r,t){e[r]=t>>24&255,e[r+1]=t>>16&255,e[r+2]=t>>8&255,e[r+3]=255&t},readASCII:function(e,r,t){for(var a="",n=0;t>n;n++)a+=String.fromCharCode(e[r+n]);return a},writeASCII:function(e,r,t){for(var a=0;a<t.length;a++)e[r+a]=t.charCodeAt(a)},readBytes:function(e,r,t){for(var a=[],n=0;t>n;n++)a.push(e[r+n]);return a},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(r,t,a){for(var n,i="",f=0;a>f;f++)i+="%"+e._bin.pad(r[t+f].toString(16));try{n=decodeURIComponent(i)}catch(o){return e._bin.readASCII(r,t,a)}return n}},e._copyTile=function(e,r,t,a,n,i,f,o,s){for(var l=Math.min(r,n),c=Math.min(t,i),v=0,u=0,d=0;c>d;d++)for(var h=0;l>h;h++)if(f>=0&&o>=0?(v=d*r+h<<2,u=(o+d)*n+f+h<<2):(v=(-o+d)*r-f+h<<2,u=d*n+h<<2),0==s)a[u]=e[v],a[u+1]=e[v+1],a[u+2]=e[v+2],a[u+3]=e[v+3];else if(1==s){var p=e[v+3]*(1/255),b=e[v]*p,g=e[v+1]*p,m=e[v+2]*p,y=a[u+3]*(1/255),w=a[u]*y,A=a[u+1]*y,U=a[u+2]*y,_=1-p,q=p+y*_,I=0==q?0:1/q;a[u+3]=255*q,a[u+0]=(b+w*_)*I,a[u+1]=(g+A*_)*I,a[u+2]=(m+U*_)*I}else if(2==s){var p=e[v+3],b=e[v],g=e[v+1],m=e[v+2],y=a[u+3],w=a[u],A=a[u+1],U=a[u+2];p==y&&b==w&&g==A&&m==U?(a[u]=0,a[u+1]=0,a[u+2]=0,a[u+3]=0):(a[u]=b,a[u+1]=g,a[u+2]=m,a[u+3]=p)}else if(3==s){var p=e[v+3],b=e[v],g=e[v+1],m=e[v+2],y=a[u+3],w=a[u],A=a[u+1],U=a[u+2];if(p==y&&b==w&&g==A&&m==U)continue;if(220>p&&y>20)return!1}return!0},e.encode=function(r,t,a,n,i,f){null==n&&(n=0),null==f&&(f=!1);var o=e.encode.compress(r,t,a,n,!1,f);return e.encode.compressPNG(o,-1),e.encode._main(o,t,a,i)},e.encodeLL=function(r,t,a,n,i,f,o){for(var s={ctype:0+(1==n?0:2)+(0==i?0:4),depth:f,frames:[]},l=(n+i)*f,c=l*t,v=0;v<r.length;v++)s.frames.push({rect:{x:0,y:0,width:t,height:a},img:new Uint8Array(r[v]),blend:0,dispose:1,bpp:Math.ceil(l/8),bpl:Math.ceil(c/8)});return e.encode.compressPNG(s,4),e.encode._main(s,t,a,o)},e.encode._main=function(r,t,a,n){var i=e.crc.crc,f=e._bin.writeUint,o=e._bin.writeUshort,s=e._bin.writeASCII,l=8,c=r.frames.length>1,v=!1,u=46+(c?20:0);if(3==r.ctype){for(var d=r.plte.length,h=0;d>h;h++)r.plte[h]>>>24!=255&&(v=!0);u+=8+3*d+4+(v?8+1*d+4:0)}for(var p=0;p<r.frames.length;p++){var b=r.frames[p];c&&(u+=38),u+=b.cimg.length+12,0!=p&&(u+=4)}u+=12;for(var g=new Uint8Array(u),m=[137,80,78,71,13,10,26,10],h=0;8>h;h++)g[h]=m[h];if(f(g,l,13),l+=4,s(g,l,"IHDR"),l+=4,f(g,l,t),l+=4,f(g,l,a),l+=4,g[l]=r.depth,l++,g[l]=r.ctype,l++,g[l]=0,l++,g[l]=0,l++,g[l]=0,l++,f(g,l,i(g,l-17,17)),l+=4,f(g,l,1),l+=4,s(g,l,"sRGB"),l+=4,g[l]=1,l++,f(g,l,i(g,l-5,5)),l+=4,c&&(f(g,l,8),l+=4,s(g,l,"acTL"),l+=4,f(g,l,r.frames.length),l+=4,f(g,l,0),l+=4,f(g,l,i(g,l-12,12)),l+=4),3==r.ctype){var d=r.plte.length;f(g,l,3*d),l+=4,s(g,l,"PLTE"),l+=4;for(var h=0;d>h;h++){var y=3*h,w=r.plte[h],A=255&w,U=w>>>8&255,_=w>>>16&255;g[l+y+0]=A,g[l+y+1]=U,g[l+y+2]=_}if(l+=3*d,f(g,l,i(g,l-3*d-4,3*d+4)),l+=4,v){f(g,l,d),l+=4,s(g,l,"tRNS"),l+=4;for(var h=0;d>h;h++)g[l+h]=r.plte[h]>>>24&255;l+=d,f(g,l,i(g,l-d-4,d+4)),l+=4}}for(var q=0,p=0;p<r.frames.length;p++){var b=r.frames[p];c&&(f(g,l,26),l+=4,s(g,l,"fcTL"),l+=4,f(g,l,q++),l+=4,f(g,l,b.rect.width),l+=4,f(g,l,b.rect.height),l+=4,f(g,l,b.rect.x),l+=4,f(g,l,b.rect.y),l+=4,o(g,l,n[p]),l+=2,o(g,l,1e3),l+=2,g[l]=b.dispose,l++,g[l]=b.blend,l++,f(g,l,i(g,l-30,30)),l+=4);var I=b.cimg,d=I.length;f(g,l,d+(0==p?0:4)),l+=4;var M=l;s(g,l,0==p?"IDAT":"fdAT"),l+=4,0!=p&&(f(g,l,q++),l+=4);for(var h=0;d>h;h++)g[l+h]=I[h];l+=d,f(g,l,i(g,M,l-M)),l+=4}return f(g,l,0),l+=4,s(g,l,"IEND"),l+=4,f(g,l,i(g,l-4,4)),l+=4,g.buffer},e.encode.compressPNG=function(r,t){for(var a=0;a<r.frames.length;a++){var n=r.frames[a],i=(n.rect.width,n.rect.height),f=new Uint8Array(i*n.bpl+i);n.cimg=e.encode._filterZero(n.img,i,n.bpp,n.bpl,f,t)}},e.encode.compress=function(r,t,a,n,i,f){null==f&&(f=!1);for(var o=6,s=8,l=255,c=0;c<r.length;c++)for(var v=new Uint8Array(r[c]),u=v.length,d=0;u>d;d+=4)l&=v[d+3];var h=255!=l,p=h&&i,b=e.encode.framize(r,t,a,i,p),g={},m=[],y=[];if(0!=n){for(var w=[],d=0;d<b.length;d++)w.push(b[d].img.buffer);for(var A=e.encode.concatRGBA(w,i),U=e.quantize(A,n),_=0,q=new Uint8Array(U.abuf),d=0;d<b.length;d++){var I=b[d].img,M=I.length;y.push(new Uint8Array(U.inds.buffer,_>>2,M>>2));for(var c=0;M>c;c+=4)I[c]=q[_+c],I[c+1]=q[_+c+1],I[c+2]=q[_+c+2],I[c+3]=q[_+c+3];_+=M}for(var d=0;d<U.plte.length;d++)m.push(U.plte[d].est.rgba)}else for(var c=0;c<b.length;c++){var T=b[c],z=new Uint32Array(T.img.buffer),R=T.rect.width,u=z.length,N=new Uint8Array(u);y.push(N);for(var d=0;u>d;d++){var L=z[d];if(0!=d&&L==z[d-1])N[d]=N[d-1];else if(d>R&&L==z[d-R])N[d]=N[d-R];else{var P=g[L];if(null==P&&(g[L]=P=m.length,m.push(L),m.length>=300))break;N[d]=P}}}var S=m.length;256>=S&&0==f&&(s=2>=S?1:4>=S?2:16>=S?4:8,i&&(s=8));for(var c=0;c<b.length;c++){var T=b[c],R=(T.rect.x,T.rect.y,T.rect.width),D=T.rect.height,B=T.img,x=(new Uint32Array(B.buffer),4*R),C=4;if(256>=S&&0==f){x=Math.ceil(s*R/8);for(var G=new Uint8Array(x*D),Z=y[c],k=0;D>k;k++){var d=k*x,E=k*R;if(8==s)for(var H=0;R>H;H++)G[d+H]=Z[E+H];else if(4==s)for(var H=0;R>H;H++)G[d+(H>>1)]|=Z[E+H]<<4-4*(1&H);else if(2==s)for(var H=0;R>H;H++)G[d+(H>>2)]|=Z[E+H]<<6-2*(3&H);else if(1==s)for(var H=0;R>H;H++)G[d+(H>>3)]|=Z[E+H]<<7-1*(7&H)}B=G,o=3,C=1}else if(0==h&&1==b.length){for(var G=new Uint8Array(R*D*3),F=R*D,d=0;F>d;d++){var I=3*d,K=4*d;G[I]=B[K],G[I+1]=B[K+1],G[I+2]=B[K+2]}B=G,o=2,C=3,x=3*R}T.img=B,T.bpl=x,T.bpp=C}return{ctype:o,depth:s,plte:m,frames:b}},e.encode.framize=function(r,t,a,n,i){for(var f=[],o=0;o<r.length;o++){var s=new Uint8Array(r[o]),l=new Uint32Array(s.buffer),c=0,v=0,u=t,d=a,h=0;if(0==o||i)s=s.slice(0);else{for(var p=n||1==o||2==f[f.length-2].dispose?1:2,b=0,g=1e9,m=0;p>m;m++){for(var y=new Uint8Array(r[o-1-m]),w=new Uint32Array(r[o-1-m]),A=t,U=a,_=-1,q=-1,I=0;a>I;I++)for(var M=0;t>M;M++){var T=I*t+M;l[T]!=w[T]&&(A>M&&(A=M),M>_&&(_=M),U>I&&(U=I),I>q&&(q=I))}var z=-1==_?1:(_-A+1)*(q-U+1);g>z&&(g=z,b=m,-1==_?(c=v=0,u=d=1):(c=A,v=U,u=_-A+1,d=q-U+1))}var y=new Uint8Array(r[o-1-b]);1==b&&(f[f.length-1].dispose=2);var R=new Uint8Array(u*d*4);new Uint32Array(R.buffer);e._copyTile(y,t,a,R,u,d,-c,-v,0),e._copyTile(s,t,a,R,u,d,-c,-v,3)?(e._copyTile(s,t,a,R,u,d,-c,-v,2),h=1):(e._copyTile(s,t,a,R,u,d,-c,-v,0),h=0),s=R}f.push({rect:{x:c,y:v,width:u,height:d},img:s,blend:h,dispose:i?1:0})}return f},e.encode._filterZero=function(t,a,n,i,f,o){if(-1!=o){for(var s=0;a>s;s++)e.encode._filterLine(f,t,s,i,n,o);return r.deflate(f)}for(var l=[],c=0;5>c;c++)if(!(a*i>5e5)||2!=c&&3!=c&&4!=c){for(var s=0;a>s;s++)e.encode._filterLine(f,t,s,i,n,c);if(l.push(r.deflate(f)),1==n)break}for(var v,u=1e9,d=0;d<l.length;d++)l[d].length<u&&(v=d,u=l[d].length);return l[v]},e.encode._filterLine=function(r,t,a,n,i,f){var o=a*n,s=o+a,l=e.decode._paeth;if(r[s]=f,s++,0==f)for(var c=0;n>c;c++)r[s+c]=t[o+c];else if(1==f){for(var c=0;i>c;c++)r[s+c]=t[o+c];for(var c=i;n>c;c++)r[s+c]=t[o+c]-t[o+c-i]+256&255}else if(0==a){for(var c=0;i>c;c++)r[s+c]=t[o+c];if(2==f)for(var c=i;n>c;c++)r[s+c]=t[o+c];if(3==f)for(var c=i;n>c;c++)r[s+c]=t[o+c]-(t[o+c-i]>>1)+256&255;if(4==f)for(var c=i;n>c;c++)r[s+c]=t[o+c]-l(t[o+c-i],0,0)+256&255}else{if(2==f)for(var c=0;n>c;c++)r[s+c]=t[o+c]+256-t[o+c-n]&255;if(3==f){for(var c=0;i>c;c++)r[s+c]=t[o+c]+256-(t[o+c-n]>>1)&255;for(var c=i;n>c;c++)r[s+c]=t[o+c]+256-(t[o+c-n]+t[o+c-i]>>1)&255}if(4==f){for(var c=0;i>c;c++)r[s+c]=t[o+c]+256-l(0,t[o+c-n],0)&255;for(var c=i;n>c;c++)r[s+c]=t[o+c]+256-l(t[o+c-i],t[o+c-n],t[o+c-i-n])&255}}},e.crc={table:function(){for(var e=new Uint32Array(256),r=0;256>r;r++){for(var t=r,a=0;8>a;a++)1&t?t=3988292384^t>>>1:t>>>=1;e[r]=t}return e}(),update:function(r,t,a,n){for(var i=0;n>i;i++)r=e.crc.table[255&(r^t[a+i])]^r>>>8;return r},crc:function(r,t,a){return 4294967295^e.crc.update(4294967295,r,t,a)}},e.quantize=function(r,t){for(var a=new Uint8Array(r),n=a.slice(0),i=new Uint32Array(n.buffer),f=e.quantize.getKDtree(n,t),o=f[0],s=f[1],l=(e.quantize.planeDst,a),c=i,v=l.length,u=new Uint8Array(a.length>>2),d=0;v>d;d+=4){var h=l[d]*(1/255),p=l[d+1]*(1/255),b=l[d+2]*(1/255),g=l[d+3]*(1/255),m=e.quantize.getNearest(o,h,p,b,g);u[d>>2]=m.ind,c[d>>2]=m.est.rgba}return{abuf:n.buffer,inds:u,plte:s}},e.quantize.getKDtree=function(r,t,a){null==a&&(a=1e-4);var n=new Uint32Array(r.buffer),i={i0:0,i1:r.length,bst:null,est:null,tdst:0,left:null,right:null};i.bst=e.quantize.stats(r,i.i0,i.i1),i.est=e.quantize.estats(i.bst);for(var f=[i];f.length<t;){for(var o=0,s=0,l=0;l<f.length;l++)f[l].est.L>o&&(o=f[l].est.L,s=l);if(a>o)break;var c=f[s],v=e.quantize.splitPixels(r,n,c.i0,c.i1,c.est.e,c.est.eMq255),u=c.i0>=v||c.i1<=v;if(u)c.est.L=0;else{var d={i0:c.i0,i1:v,bst:null,est:null,tdst:0,left:null,right:null};d.bst=e.quantize.stats(r,d.i0,d.i1),d.est=e.quantize.estats(d.bst);var h={i0:v,i1:c.i1,bst:null,est:null,tdst:0,left:null,right:null};h.bst={R:[],m:[],N:c.bst.N-d.bst.N};for(var l=0;16>l;l++)h.bst.R[l]=c.bst.R[l]-d.bst.R[l];for(var l=0;4>l;l++)h.bst.m[l]=c.bst.m[l]-d.bst.m[l];h.est=e.quantize.estats(h.bst),c.left=d,c.right=h,f[s]=d,f.push(h)}}f.sort(function(e,r){return r.bst.N-e.bst.N});for(var l=0;l<f.length;l++)f[l].ind=l;return[i,f]},e.quantize.getNearest=function(r,t,a,n,i){if(null==r.left)return r.tdst=e.quantize.dist(r.est.q,t,a,n,i),r;var f=e.quantize.planeDst(r.est,t,a,n,i),o=r.left,s=r.right;f>0&&(o=r.right,s=r.left);var l=e.quantize.getNearest(o,t,a,n,i);if(l.tdst<=f*f)return l;var c=e.quantize.getNearest(s,t,a,n,i);return c.tdst<l.tdst?c:l},e.quantize.planeDst=function(e,r,t,a,n){var i=e.e;return i[0]*r+i[1]*t+i[2]*a+i[3]*n-e.eMq},e.quantize.dist=function(e,r,t,a,n){var i=r-e[0],f=t-e[1],o=a-e[2],s=n-e[3];return i*i+f*f+o*o+s*s},e.quantize.splitPixels=function(r,t,a,n,i,f){var o=e.quantize.vecDot;n-=4;for(;n>a;){for(;o(r,a,i)<=f;)a+=4;for(;o(r,n,i)>f;)n-=4;if(a>=n)break;var s=t[a>>2];t[a>>2]=t[n>>2],t[n>>2]=s,a+=4,n-=4}for(;o(r,a,i)>f;)a-=4;return a+4},e.quantize.vecDot=function(e,r,t){return e[r]*t[0]+e[r+1]*t[1]+e[r+2]*t[2]+e[r+3]*t[3]},e.quantize.stats=function(e,r,t){for(var a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n=[0,0,0,0],i=t-r>>2,f=r;t>f;f+=4){var o=e[f]*(1/255),s=e[f+1]*(1/255),l=e[f+2]*(1/255),c=e[f+3]*(1/255);n[0]+=o,n[1]+=s,n[2]+=l,n[3]+=c,a[0]+=o*o,a[1]+=o*s,a[2]+=o*l,a[3]+=o*c,a[5]+=s*s,a[6]+=s*l,a[7]+=s*c,a[10]+=l*l,a[11]+=l*c,a[15]+=c*c}return a[4]=a[1],a[8]=a[2],a[9]=a[6],a[12]=a[3],a[13]=a[7],a[14]=a[11],{R:a,m:n,N:i}},e.quantize.estats=function(r){var t=r.R,a=r.m,n=r.N,i=a[0],f=a[1],o=a[2],s=a[3],l=0==n?0:1/n,c=[t[0]-i*i*l,t[1]-i*f*l,t[2]-i*o*l,t[3]-i*s*l,t[4]-f*i*l,t[5]-f*f*l,t[6]-f*o*l,t[7]-f*s*l,t[8]-o*i*l,t[9]-o*f*l,t[10]-o*o*l,t[11]-o*s*l,t[12]-s*i*l,t[13]-s*f*l,t[14]-s*o*l,t[15]-s*s*l],v=c,u=e.M4,d=[.5,.5,.5,.5],h=0,p=0;if(0!=n)for(var b=0;10>b&&(d=u.multVec(v,d),p=Math.sqrt(u.dot(d,d)),d=u.sml(1/p,d),!(Math.abs(p-h)<1e-9));b++)h=p;var g=[i*l,f*l,o*l,s*l],m=u.dot(u.sml(255,g),d);return{Cov:c,q:g,e:d,L:h,eMq255:m,eMq:u.dot(d,g),rgba:(Math.round(255*g[3])<<24|Math.round(255*g[2])<<16|Math.round(255*g[1])<<8|Math.round(255*g[0])<<0)>>>0}},e.M4={multVec:function(e,r){return[e[0]*r[0]+e[1]*r[1]+e[2]*r[2]+e[3]*r[3],e[4]*r[0]+e[5]*r[1]+e[6]*r[2]+e[7]*r[3],e[8]*r[0]+e[9]*r[1]+e[10]*r[2]+e[11]*r[3],e[12]*r[0]+e[13]*r[1]+e[14]*r[2]+e[15]*r[3]]},dot:function(e,r){return e[0]*r[0]+e[1]*r[1]+e[2]*r[2]+e[3]*r[3]},sml:function(e,r){return[e*r[0],e*r[1],e*r[2],e*r[3]]}},e.encode.concatRGBA=function(e,r){for(var t=0,a=0;a<e.length;a++)t+=e[a].byteLength;for(var n=new Uint8Array(t),i=0,a=0;a<e.length;a++){for(var f=new Uint8Array(e[a]),o=f.length,s=0;o>s;s+=4){var l=f[s],c=f[s+1],v=f[s+2],u=f[s+3];r&&(u=0==(128&u)?0:255),0==u&&(l=c=v=0),n[i+s]=l,n[i+s+1]=c,n[i+s+2]=v,n[i+s+3]=u}i+=o}return n.buffer}}(r,e)}();